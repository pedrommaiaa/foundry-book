<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Creating an NFT with Solmate - Foundry Book</title>
        <!-- Custom HTML head -->
        <meta name="twitter:card" content="summary">
        <meta property="og:title" content="Foundry Book" />
        <meta property="og:description" content="A book on all things Foundry" />
        <meta name="twitter:image:src" content="https://raw.githubusercontent.com/onbjerg/foundry-book/master/theme/card.png" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A book on all things Foundry">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../src/static/custom.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Getting Started</li><li class="chapter-item expanded "><a href="../getting-started/installation.html">Installation</a></li><li class="chapter-item expanded "><a href="../getting-started/first-steps.html">First Steps with Foundry</a></li><li class="chapter-item expanded affix "><li class="part-title">Projects</li><li class="chapter-item expanded "><a href="../projects/creating-a-new-project.html">Creating a New Project</a></li><li class="chapter-item expanded "><a href="../projects/working-on-an-existing-project.html">Working on an Existing Project</a></li><li class="chapter-item expanded "><a href="../projects/dependencies.html">Dependencies</a></li><li class="chapter-item expanded "><a href="../projects/project-layout.html">Project Layout</a></li><li class="chapter-item expanded affix "><li class="part-title">Forge Overview</li><li class="chapter-item expanded "><a href="../forge/index.html">Overview of forge</a></li><li class="chapter-item expanded "><a href="../forge/tests.html">Tests</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../forge/writing-tests.html">Writing Tests</a></li><li class="chapter-item "><a href="../forge/cheatcodes.html">Cheatcodes</a></li><li class="chapter-item "><a href="../forge/traces.html">Understanding Traces</a></li><li class="chapter-item "><a href="../forge/forking-mode.html">Forking Mode</a></li></ol></li><li class="chapter-item expanded "><a href="../forge/advanced-testing.html">Advanced Testing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../forge/fuzz-testing.html">Fuzz Testing</a></li></ol></li><li class="chapter-item expanded "><a href="../forge/deploying.html">Deploying and Verifying</a></li><li class="chapter-item expanded "><div>Gas Tracking</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../forge/gas-reports.html">Gas Reports</a></li></ol></li><li class="chapter-item expanded "><a href="../forge/debugger.html">Debugger</a></li><li class="chapter-item expanded affix "><li class="part-title">Cast Overview</li><li class="chapter-item expanded "><a href="../cast/index.html">Overview of cast</a></li><li class="chapter-item expanded affix "><li class="part-title">Configuration</li><li class="chapter-item expanded "><a href="../config/index.html">Configuring with foundry.toml</a></li><li class="chapter-item expanded "><a href="../config/continous-integration.html">Continuous Integration</a></li><li class="chapter-item expanded "><a href="../config/vscode.html">Integrating with VSCode</a></li><li class="chapter-item expanded "><a href="../config/shell-autocompletion.html">Shell Autocompletion</a></li><li class="chapter-item expanded affix "><li class="part-title">Tutorials</li><li class="chapter-item expanded "><a href="../tutorials/solmate-nft.html" class="active">Creating an NFT with Solmate</a></li><li class="chapter-item expanded "><a href="../tutorials/foundry-docker.html">Docker and Foundry</a></li><li class="chapter-item expanded affix "><li class="part-title">Appendix</li><li class="chapter-item expanded "><div>FAQ</div></li><li class="chapter-item expanded "><div>References</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>forge Reference</div></li><li class="chapter-item "><a href="../reference/cast.html">cast Reference</a></li><li class="chapter-item "><a href="../reference/config.html">foundry.toml Reference</a></li><li class="chapter-item "><a href="../reference/ds-test.html">ds-test Reference</a></li><li class="chapter-item "><a href="../cheatcodes/index.html">Cheatcodes Reference</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/environment.html">Environment</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/warp.html">warp</a></li><li class="chapter-item "><a href="../cheatcodes/roll.html">roll</a></li><li class="chapter-item "><a href="../cheatcodes/fee.html">fee</a></li><li class="chapter-item "><a href="../cheatcodes/store.html">store</a></li><li class="chapter-item "><a href="../cheatcodes/load.html">load</a></li><li class="chapter-item "><a href="../cheatcodes/etch.html">etch</a></li><li class="chapter-item "><a href="../cheatcodes/deal.html">deal</a></li><li class="chapter-item "><a href="../cheatcodes/prank.html">prank</a></li><li class="chapter-item "><a href="../cheatcodes/start-prank.html">startPrank</a></li><li class="chapter-item "><a href="../cheatcodes/stop-prank.html">stopPrank</a></li><li class="chapter-item "><a href="../cheatcodes/record.html">record</a></li><li class="chapter-item "><a href="../cheatcodes/accesses.html">accesses</a></li><li class="chapter-item "><a href="../cheatcodes/set-nonce.html">setNonce</a></li><li class="chapter-item "><a href="../cheatcodes/get-nonce.html">getNonce</a></li><li class="chapter-item "><a href="../cheatcodes/mock-call.html">mockCall</a></li><li class="chapter-item "><a href="../cheatcodes/clear-mocked-calls.html">clearMockedCalls</a></li></ol></li><li class="chapter-item "><a href="../cheatcodes/assertions.html">Assertions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/expect-revert.html">expectRevert</a></li><li class="chapter-item "><a href="../cheatcodes/expect-emit.html">expectEmit</a></li><li class="chapter-item "><a href="../cheatcodes/expect-call.html">expectCall</a></li></ol></li><li class="chapter-item "><a href="../cheatcodes/fuzzer.html">Fuzzer</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/assume.html">assume</a></li></ol></li><li class="chapter-item "><a href="../cheatcodes/external.html">External</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/ffi.html">ffi</a></li><li class="chapter-item "><a href="../cheatcodes/get-code.html">getCode</a></li></ol></li><li class="chapter-item "><a href="../cheatcodes/utilities.html">Utilities</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../cheatcodes/addr.html">addr</a></li><li class="chapter-item "><a href="../cheatcodes/sign.html">sign</a></li><li class="chapter-item "><a href="../cheatcodes/label.html">label</a></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Foundry Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/onbjerg/foundry-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/onbjerg/foundry-book/edit/master/src/tutorials/solmate-nft.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="creating-an-nft-with-solmate"><a class="header" href="#creating-an-nft-with-solmate">Creating an NFT with Solmate</a></h2>
<p>This tutorial walk you through creating an OpenSea compatible NFT with Foundry and <a href="https://github.com/Rari-Capital/solmate/blob/main/src/tokens/ERC721.sol">Solmate</a>. A full implementation of this tutorial can be found <a href="https://github.com/FredCoen/nft-tutorial">here</a>.</p>
<h5 id="this-tutorial-is-for-illustrative-purposes-only-and-provided-on-an-as-is-basis-the-tutorial-is-not-audited-nor-fully-tested-no-code-in-this-tutorial-should-be-used-in-a-production-environment"><a class="header" href="#this-tutorial-is-for-illustrative-purposes-only-and-provided-on-an-as-is-basis-the-tutorial-is-not-audited-nor-fully-tested-no-code-in-this-tutorial-should-be-used-in-a-production-environment">This tutorial is for illustrative purposes only and provided on an as-is basis. The tutorial is not audited nor fully tested. No code in this tutorial should be used in a production environment.</a></h5>
<h3 id="create-project-and-install-dependencies"><a class="header" href="#create-project-and-install-dependencies">Create project and install dependencies</a></h3>
<p>Start by setting up a Foundry project following the steps outlined in the <a href="../getting-started/installation.html">Getting started section</a>. We will also install Solmate for their ERC721 implementation, as well as some OpenZeppelin utility libraries. Install the dependencies by running the following commands from the root of your project:</p>
<pre><code class="language-bash">forge install Rari-Capital/solmate Openzeppelin/openzeppelin-contracts brockelmore/forge-std
</code></pre>
<p>These dependencies will be added as git submodules to your project.</p>
<p>If you have followed the instructions correctly your project should be structured like this:</p>
<p><img src="../images/nft-tutorial/nft-tutorial-project-structure.png" alt="Project structure" /></p>
<h3 id="implement-a-basic-nft"><a class="header" href="#implement-a-basic-nft">Implement a basic NFT</a></h3>
<p>We are then going to rename the boilerplate contract in <code>src/Contract.sol</code> to <code>src/NFT.sol</code> and replace the code:</p>
<pre><code class="language-solidity">// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.10;

import &quot;solmate/tokens/ERC721.sol&quot;;
import &quot;openzeppelin-contracts/contracts/utils/Strings.sol&quot;;

contract NFT is ERC721 {
    uint256 public currentTokenId;

    constructor(
        string memory _name,
        string memory _symbol
    ) ERC721(_name, _symbol) {}

    function mintTo(address recipient) public payable returns (uint256) {
        uint256 newItemId = ++currentTokenId;
        _safeMint(recipient, newItemId);
        return newItemId;
    }

    function tokenURI(uint256 id) public view virtual override returns (string memory) {
        return Strings.toString(id);
    }
}
</code></pre>
<p>Let's take a look at this very basic implementation of an NFT. We start by importing to contracts from our git submodules. We import solmate's gas optimised implementation of the ERC721 standard which our NFT contract will inherit from. Our constructor takes the <code>_name</code> and <code>_symbol</code> arguments for our NFT and passes them on to the constructor of the parent ERC721 implementation. Lastly we implement the <code>mintTo</code> function which allows anyone to mint an NFT. This function increments the <code>currentTokenId</code> and makes use of the <code>_safeMint</code> function of our parent contract.</p>
<h3 id="compile--deploy-with-forge"><a class="header" href="#compile--deploy-with-forge">Compile &amp; deploy with forge</a></h3>
<p>To compile the NFT contract run <code>forge build</code>. By default the compiler output will be in the <code>out</code> directory. To deploy our compiled contract with Forge we have to set environment variables for the RPC endpoint and the private key we want to use to deploy.</p>
<p>Set your environment variables by running:</p>
<pre><code class="language-bash">export RPC_URL=&lt;Your RPC endpoint&gt;
export PRIVATE_KEY=&lt;Your wallets private key&gt;
</code></pre>
<p>Once set, you can deploy your NFT with Forge by running the below command while adding the relevant constructor arguments to the NFT contract:</p>
<pre><code class="language-bash">forge create NFT --rpc-url=$RPC_URL --private-key=$PRIVATE_KEY --constructor-args &lt;name&gt; &lt;symbol&gt; 
</code></pre>
<p>If successfully deployed, you will see the deploying wallet's address, the contract's address as well as the transaction hash printed to your terminal.</p>
<h3 id="minting-nfts-from-your-contract"><a class="header" href="#minting-nfts-from-your-contract">Minting NFTs from your contract</a></h3>
<p>Calling functions on your NFT contract is made simple with Cast, Foundry's command-line tool for interacting with smart contracts, sending transactions, and getting chain data. Let's have a look at how we can use it to mint NFTs from our NFT contract.</p>
<p>Given that you already set your RPC and private key env variables during deployment, mint an NFT from your contract by
running:</p>
<pre><code class="language-bash">cast send --rpc-url=$RPC_URL &lt;contractAddress&gt;  &quot;mintTo(address)&quot; &lt;arg&gt; --private-key=$PRIVATE_KEY
</code></pre>
<p>Well done! You just minted your first NFT from your contract. You can sanity check the owner of the NFT with <code>currentTokenId</code> equal to <strong>1</strong> by running the below <code>cast call</code> command. The address you provided above should be returned as the owner.</p>
<pre><code class="language-bash">cast call --rpc-url=$RPC_URL --private-key=$PRIVATE_KEY &lt;contractAddress&gt; &quot;ownerOf(uint256)&quot; 1
</code></pre>
<h3 id="extending-our-nft-contract-functionality-and-testing"><a class="header" href="#extending-our-nft-contract-functionality-and-testing">Extending our NFT contract functionality and testing</a></h3>
<p>Let's extend our NFT by adding metadata to represent the content of our NFTs, as well as set a minting price, a maximum supply and the possibility to withdraw the collected proceeds from minting. To follow along you can replace your current NFT contract with the code snippet below:</p>
<pre><code class="language-solidity">// SPDX-License-Identifier: UNLICENSED
pragma solidity &gt;=0.8.10;

import &quot;solmate/tokens/ERC721.sol&quot;;
import &quot;openzeppelin-contracts/contracts/utils/Strings.sol&quot;;
import &quot;openzeppelin-contracts/contracts/access/Ownable.sol&quot;;

error MintPriceNotPaid();
error MaxSupply();
error NonExistentTokenURI();
error WithdrawTransfer();

contract NFT is ERC721, Ownable {

    using Strings for uint256;
    string public baseURI;
    uint256 public currentTokenId;
    uint256 public constant TOTAL_SUPPLY = 10_000;
    uint256 public constant MINT_PRICE = 0.08 ether;

    constructor(
        string memory _name,
        string memory _symbol,
        string memory _baseURI
    ) ERC721(_name, _symbol) {
        baseURI = _baseURI;
    }

    function mintTo(address recipient) public payable returns (uint256) {
        if (msg.value != MINT_PRICE) {
            revert MintPriceNotPaid();
        }
        uint256 newTokenId = ++currentTokenId;
        if (newTokenId &gt; TOTAL_SUPPLY) {
            revert MaxSupply();
        }
        _safeMint(recipient, newTokenId);
        return newTokenId;
    }

    function tokenURI(uint256 tokenId)
        public
        view
        virtual
        override
        returns (string memory)
    {
        if (ownerOf[tokenId] == address(0)) {
            revert NonExistentTokenURI();
        }
        return
            bytes(baseURI).length &gt; 0
                ? string(abi.encodePacked(baseURI, tokenId.toString()))
                : &quot;&quot;;
    }

    function withdrawPayments(address payable payee) external onlyOwner {
        uint256 balance = address(this).balance;
        (bool transferTx, ) = payee.call{value: balance}(&quot;&quot;);
        if (!transferTx) {
            revert WithdrawTransfer();
        }
    }
}
</code></pre>
<p>Among other things, we have added metadata that can be queried from any front-end application like OpenSea, by calling the <code>tokenURI</code> method on our NFT contract.</p>
<blockquote>
<p><strong>Note</strong>: If you want to provide a real URL to the constructor at deployment, and host the metadata of this NFT contract please follow the steps outlined <a href="https://docs.opensea.io/docs/part-3-adding-metadata-and-payments-to-your-contract#intro-to-nft-metadata">here</a>.</p>
</blockquote>
<p>Let's test some of this added functionality to make sure it works as intended. Foundry offers an extremely fast EVM native testing framework through Forge.</p>
<p>Within your test folder rename the current <code>Contract.t.sol</code> test file to <code>NFT.t.sol</code>. This file will contain all tests regarding the NFT's <code>mintTo</code> method. Next, replace the existing boilerplate code with the below:</p>
<pre><code class="language-solidity">// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.10;

import &quot;ds-test/test.sol&quot;;
import &quot;forge-std/stdlib.sol&quot;;
import &quot;forge-std/Vm.sol&quot;;
import &quot;../NFT.sol&quot;;

contract NFTTest is DSTest {
    using stdStorage for StdStorage;

    Vm private vm = Vm(HEVM_ADDRESS);
    NFT private nft;
    StdStorage private stdstore;

    function setUp() public {
        // Deploy NFT contract
        nft = new NFT(&quot;NFT_tutorial&quot;, &quot;TUT&quot;, &quot;baseUri&quot;);
    }

    function testFailNoMintPricePaid() public {
        nft.mintTo(address(1));
    }

    function testMintPricePaid() public {
        nft.mintTo{value: 0.08 ether}(address(1));
    }

    function testFailMaxSupplyReached() public {
        uint256 slot = stdstore.target(address(nft)).sig(&quot;currentTokenId()&quot;).find();
        bytes32 loc = bytes32(slot);
        bytes32 mockedCurrentTokenId = bytes32(abi.encode(10000));
        vm.store(address(nft), loc, mockedCurrentTokenId);
        nft.mintTo{value: 0.08 ether}(address(1));
    }

    function testFailMintToZeroAddress() public {
        nft.mintTo{value: 0.08 ether}(address(0));
    }

    function testNewMintOwnerRegistered() public {
        nft.mintTo{value: 0.08 ether}(address(1));
        uint256 slotOfNewOwner = stdstore
            .target(address(nft))
            .sig(nft.ownerOf.selector)
            .with_key(1)
            .find();

        uint160 ownerOfTokenIdOne = uint160(uint256((vm.load(address(nft),bytes32(abi.encode(slotOfNewOwner))))));
        assertEq(address(ownerOfTokenIdOne), address(1));
    }

    function testBalanceIncremented() public { 
        nft.mintTo{value: 0.08 ether}(address(1));
        uint256 slotBalance = stdstore
            .target(address(nft))
            .sig(nft.balanceOf.selector)
            .with_key(address(1))
            .find();
        
        uint256 balanceFirstMint = uint256(vm.load(address(nft), bytes32(slotBalance)));
        assertEq(balanceFirstMint, 1);

        nft.mintTo{value: 0.08 ether}(address(1));
        uint256 balanceSecondMint = uint256(vm.load(address(nft), bytes32(slotBalance)));
        assertEq(balanceSecondMint, 2);
    }

    function testSafeContractReceiver() public {
        Receiver receiver = new Receiver();
        nft.mintTo{value: 0.08 ether}(address(receiver));
         uint256 slotBalance = stdstore
            .target(address(nft))
            .sig(nft.balanceOf.selector)
            .with_key(address(receiver))
            .find();

        uint256 balance = uint256(vm.load(address(nft), bytes32(slotBalance)));
        assertEq(balance, 1);
    }
    
    function testFailUnSafeContractReceiver() public {
        vm.etch(address(1), bytes(&quot;mock code&quot;));
        nft.mintTo{value: 0.08 ether}(address(1));
    }

    function testWithdrawalWorksAsOwner() public {
        // Mint an NFT, sending eth to the contract
        Receiver receiver = new Receiver();
        address payable payee = payable(address(0x1337));
        uint256 priorPayeeBalance = payee.balance;
        nft.mintTo{value: nft.MINT_PRICE()}(address(receiver));
        // Check that the balance of the contract is correct
        assertEq(address(nft).balance, nft.MINT_PRICE());
        uint256 nftBalance = address(nft).balance;
        // Withdraw the balance and assert it was transferred
        nft.withdrawPayments(payee);
        assertEq(payee.balance, priorPayeeBalance + nftBalance);
    }

    function testWithdrawalFailsAsNotOwner() public {
        // Mint an NFT, sending eht to the contract
        Receiver receiver = new Receiver();
        nft.mintTo{value: nft.MINT_PRICE()}(address(receiver));
        // Check that the balance of the contract is correct
        assertEq(address(nft).balance, nft.MINT_PRICE());
        // Confirm that a non-owner cannot withdraw
        vm.expectRevert(&quot;Ownable: caller is not the owner&quot;);
        vm.startPrank(address(0xd3ad));
        nft.withdrawPayments(payable(address(0xd3ad)));
        vm.stopPrank();
    }
}

contract Receiver is ERC721TokenReceiver {
    function onERC721Received(
        address operator,
        address from,
        uint256 id,
        bytes calldata data
    ) external returns (bytes4){
        return this.onERC721Received.selector;
    }
}

</code></pre>
<p>The test suite is set up as a contract with a <code>setUp</code> method which runs before every individual test.</p>
<p>As you can see, Forge offers a number of <a href="../forge/cheatcodes">cheatcodes</a> to manipulate state to accommodate your testing scenario.</p>
<p>For example, our <code>testFailMaxSupplyReached</code> test checks that an attempt to mint fails when the max supply of NFT is reached. Thus, the <code>currentTokenId</code> of the NFT contract needs to be set to the max supply by using the store cheatcode which allows you to write data to your contracts storage slots. The storage slots you wish to write to can easily be found using the
<a href="https://github.com/brockelmore/forge-std/"><code>forge-std</code></a> helper library. You can run the test with the following command:</p>
<pre><code class="language-bash">forge test
</code></pre>
<p>If you want to put your Forge skills to practice, write tests for the remaining methods of our NFT contract. Feel free to PR them to <a href="https://github.com/FredCoen/nft-tutorial">nft-tutorial</a>, where you will find the full implementation of this tutorial.</p>
<h3 id="gas-reports-for-your-function-calls"><a class="header" href="#gas-reports-for-your-function-calls">Gas reports for your function calls</a></h3>
<p>Foundry provides comprehensive gas reports about your contracts. For every function called within your tests, it returns the minimum, average, median and max gas cost. To print the gas report simply run:</p>
<pre><code class="language-bash">forge test --gas-report
</code></pre>
<p>This comes in handy when looking at various gas optimizations within your contracts.</p>
<p>Let's have a look at the gas savings we made by substituting OpenZeppelin with Solmate for our ERC721 implementation. You can find the NFT implementation using both libraries <a href="https://github.com/FredCoen/nft-tutorial">here</a>. Below are the resulting gas reports when running <code>forge test --gas-report</code> on that repository.</p>
<p>As you can see, our implementation using Solmate saves around 500 gas on a successful mint (the max gas cost of the <code>mintTo</code> function calls).</p>
<p><img src="../images/nft-tutorial/gas-report-solmate-nft.png" alt="Gas report solmate NFT" /></p>
<p><img src="../images/nft-tutorial/gas-report-oz-nft.png" alt="Gas report OZ NFT" /></p>
<p>That's it, I hope this will give you a good practical basis of how to get started with foundry. We think there is no better way to deeply understand solidity than writing your tests in solidity. You will also experience less context switching between javascript and solidity. Happy coding!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../config/shell-autocompletion.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../tutorials/foundry-docker.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../config/shell-autocompletion.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../tutorials/foundry-docker.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../src/static/solidity.min.js"></script>
    </body>
</html>
